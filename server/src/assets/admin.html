<!DOCTYPE html>
<html lang="en">

<head>
	<link rel="icon" type="image/png" id=favIcon href="favicon.jpg" />

	<link rel="stylesheet" href="./dependencies/bootstrap.min.css" />
	<link rel="stylesheet" href="./dependencies/bootstrap4-toggle.min.css" />
	<link rel="stylesheet" href="style.css" />

	<script src="./dependencies/jquery.min.js"></script>
	<script src="./dependencies/bootstrap4-toggle.min.js"></script>


	<script src="script.js"></script>

	<title>SWTbahn Admin Client</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
	<div class="row">
		<div class="col-sm-6">
			<div id="swtLogo"></div>
		</div>
		<div class="col-sm-6">
			<div id="userLogo">Admin</div>
		</div>
	</div>
	<hr />

	<div class="card-deck">
		
		<div class="card" style="width: 22rem;">
			<div class="card-body">
				<h3 class="card-title"> System</h3>
				<div class="form-group">
					<button id=pingButton type="button" class="btn btn-outline-primary btn-block">Ping SWTbahn Server</button>
					<br />
					<div class="alert alert-info" role="alert">
						<span id=pingResponse></span>
					</div>
				</div>
				<br />
				<div class="form-group">
					<div style="display: flex; justify-content: space-between;">
						<button id=startupButton type="button" class="btn btn-outline-primary" style="width: 49%;">Startup</button>
						<button id=shutdownButton type="button" class="btn btn-outline-primary" style="width: 49%;">Shutdown</button>
					</div>
					<br />
					<div class="alert alert-info" role="alert">
						<span id=startupShutdownResponse></span>
					</div>
				</div>
			</div>
		</div>
		
		<div class="card" style="width: 22rem;">
			<div class="card-body">
				
				<h3 class="card-title">  Verification</h3>
				<div class="form-group">
					<label style="color:#007bff">Verification for Train Engines </label>
					<input type="checkbox" id="verificationToggle" data-toggle="toggle" data-size="xs">
					<br />
					<div class="alert alert-info" role="alert">
						<span id=verificationSettingResponse></span>
					</div>
				</div>
			</div>
		</div>
		<script>
			// Admin
			// Initialize Toggle: Check if Verification is enabled and update toggle accordingly
			$.ajax({
				type: 'GET',
				url: '/monitor/verification-option',
				crossDomain: true,
				dataType: 'text',
				success: function (responseData, textStatus, jqXHR) {
					try {
						if (typeof responseData === 'string') {
							if (responseData === "verification-enabled: true") {
								//First option for Gecko/Firefox default; 
								// second bootstrap setter is needed for some Chromium browsers
								$('#verificationToggle').prop('checked',true);
								$('#verificationToggle').bootstrapToggle('on');
							} else if (responseData === "verification-enabled: false") {
								$('#verificationToggle').prop('checked',false);
								$('#verificationToggle').bootstrapToggle('off');
							}
						}
						// Mark toggle initialized
						toggleInit = true;
					} catch (error) {
						console.log("Get Verification encountered error: " + error);
					}
				},
				error: function (responseData, textStatus, errorThrown) {
					// Mark as initialized on error as well, as else nothing about the toggle will work
					toggleInit = true;
					console.log("ERROR GET Verification: " + responseData);
				}
			});
			
			
			// User changes toggle
			$('#verificationToggle').change(function () {
				if (!toggleInit) { //if not yet initialized, skip
					return;
				}
				var toggleState = $('#verificationToggle').prop('checked');
				// Send request to server to set verification accordingly.
				$.ajax({
					type: 'POST',
					url: '/admin/set-verification-option',
					crossDomain: true,
					data: { 'verification-option': toggleState},
					dataType: 'text',
					success: function (responseData, textStatus, jqXHR) {
						console.log((toggleState ? "Enabled" : "Disabled") + " verification.");
						$('#verificationSettingResponse').parent().removeClass('alert-danger');
						$('#verificationSettingResponse').parent().addClass('alert-success');
					},
					error: function (responseData, textStatus, errorThrown) {
						console.log("Failed to " + (toggleState ? "enable" : "disable") + " verification.");
						$('#verificationSettingResponse').parent().removeClass('alert-success');
						$('#verificationSettingResponse').parent().addClass('alert-danger');
					}
				});
			});
		</script>
	</div>
</body>

</html>
